<section class="page">
  <header class="page-header">
    <h2>Blogs you follow</h2>
    <div class="subtle" *ngIf="loading">Loadingâ€¦</div>
  </header>

  <div *ngIf="!loading && followingReady && filtered.length === 0" class="empty-state">
    <div class="empty-emoji">ðŸ‘€</div>
    <h3>No blogs to show</h3>
    <p>Start following authors and new blogs will appear.</p>
  </div>

  <div class="blog-grid" *ngIf="filtered.length > 0">
    <article class="blog-card" *ngFor="let blog of filtered">
      <div class="card-header">
        <div class="title-wrap">
          <h3 class="title" [title]="blog.title">{{ blog.title }}</h3>
          <div class="meta">
            <span class="author-chip">{{ getAuthorLabel(blog.authorId) }}</span>
            <span class="dot">â€¢</span>
            <span class="date" *ngIf="blog.createdAt as dt">{{ dt | date:'medium' }}</span>
          </div>
        </div>

        <!-- (opciono) follow/unfollow dugme -->
        <button
          class="follow-btn"
          (click)="toggleFollow(blog.authorId)"
          aria-label="Zaprati/Unfollow korisnika">
          {{ isFollowing(blog.authorId) ? 'Unfollow' : 'Follow' }}
        </button>
      </div>

      <div class="content">
        <markdown [data]="blog.content"></markdown>
      </div>

      <div class="gallery" *ngIf="blog.imagePaths && blog.imagePaths.length">
        <div class="thumb" *ngFor="let imgPath of blog.imagePaths">
          <img [src]="'http://localhost:8081' + imgPath" alt="Blog image">
        </div>
      </div>

      <div class="card-footer">
        <xp-like [blogId]="blog.id"></xp-like>
      </div>

      <div class="comments">
        <ng-container *ngIf="followingReady">
          <ng-container *ngIf="canComment(blog.authorId); else mustFollow">
            <xp-comment [blogId]="blog.id"></xp-comment>
          </ng-container>
          <ng-template #mustFollow>
            <div class="comment-locked">
              <p>To leave a comment, first follow this user.</p>
            </div>
          </ng-template>
        </ng-container>
      </div>
    </article>
  </div>
</section>
